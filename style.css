/* Make URL input mono-like */
#civlens-ext #civlens-url-input-0 textarea,
#civlens-ext #civlens-url-input-1 textarea,
#civlens-ext #civlens-url-input-2 textarea,
#civlens-ext #civlens-url-input-3 textarea,
#civlens-ext #civlens-url-input-4 textarea {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
                 "Liberation Mono", "Courier New", monospace;
    font-size: 12px;
}

/* Group styling */
#civlens-ext .gr-group {
    border: 1px solid #1f2937 !important;
    border-radius: 8px !important;
    padding: 10px !important;
    margin-bottom: 2px !important;
}

/* Keep hidden control buttons out of sight */
#civlens-ext .civlens-hidden-controls {
    display: none !important;
}

/* Native Tab Styling Overrides */
#civlens-search-tabs > .tab-nav {
    border-bottom: 1px solid #334155 !important;
    background: #0f172a !important;
    gap: 4px !important;
    padding: 8px 12px 0 !important;
}

#civlens-search-tabs > .tab-nav > button {
    background: #1e293b !important;
    border: 1px solid transparent !important;
    border-bottom: none !important;
    border-radius: 8px 8px 0 0 !important;
    color: #94a3b8 !important;
    margin-bottom: 0 !important;
    font-size: 13px !important;
    padding: 6px 30px 6px 12px !important; /* Extra padding on right for close button */
    position: relative !important;
    transition: all 0.2s ease !important;
}

#civlens-search-tabs > .tab-nav > button:hover {
    background: #334155 !important;
    color: #e2e8f0 !important;
}

#civlens-search-tabs > .tab-nav > button.selected {
    background: #0b0f19 !important;
    color: #fff !important;
    border: 1px solid #334155 !important;
    border-bottom: 1px solid #0b0f19 !important;
    z-index: 10 !important;
    margin-bottom: -1px !important;
    font-weight: 500 !important;
}

/* Close button via pseudo-element */
#civlens-search-tabs > .tab-nav > button:not(:last-child)::after {
    content: "×";
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    line-height: 18px;
    text-align: center;
    border-radius: 50%;
    font-size: 16px;
    color: #94a3b8;
    cursor: pointer;
    transition: all 0.2s ease;
    opacity: 0;
}

/* Force show for last child if it is NOT the "+" tab (which is determined by content/JS, but CSS can't know)
   Actually, the "+" tab is the last-child in DOM.
   BUT when we hide the "+" tab (via visible=False update), the 5th tab becomes the last visible child?
   No, Gradio likely keeps it in DOM but hidden.
   
   The issue is likely :not(:last-child) selector is matching the 5th tab when + is hidden or if + is considered last.
   If + is hidden, 5th tab is NOT last-child if + is still in DOM.
   But if + is NOT hidden (normal case), 5th tab is not last child.
   Wait, if we have 5 tabs, + is hidden. So 5th tab IS last visible child?
   :last-child matches the last element in parent, regardless of visibility.
   So if + is hidden but present, 5th tab is NOT last-child.
   
   However, we used :not(:last-child) to exclude the "+" tab.
   If the 5th tab is open, and + is hidden, 5th tab is the 5th element. + is the 6th.
   So 5th tab matches :not(:last-child). So it should have the close button.
   
   Why did the user say "the 5th does not even have the x"?
   Maybe because when 5 tabs are open, the "+" tab is removed from DOM or something?
   If + is hidden via display:none, it's still last-child.
   
   Let's change the selector to be more specific or robust.
   We can target buttons that contain "Search".
*/

#civlens-search-tabs > .tab-nav > button::after {
    content: "×";
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 18px;
    height: 18px;
    line-height: 18px;
    text-align: center;
    border-radius: 50%;
    font-size: 16px;
    color: #94a3b8;
    cursor: pointer;
    transition: all 0.2s ease;
    opacity: 0;
}

/* Hide it for the plus tab specifically */
#civlens-search-tabs > .tab-nav > button:last-child::after {
    display: none !important; 
    /* This assumes last-child IS the plus tab. 
       If plus tab is hidden (display:none), it is still last-child.
       So this logic holds.
       UNLESS Gradio removes it from DOM?
       If Gradio removes it, then 5th tab becomes last-child and gets hidden.
       
       Let's check if we can distinguish by text content in CSS? No.
       
       We can assume that if the button text is "➕", we hide ::after.
       We can't do that in CSS3.
       
       However, we can just ALWAYS show it on hover, and rely on JS to ignore clicks on +.
       And use CSS to hide it on the last child if we are sure it's the plus tab.
       
       If the 5th tab doesn't have X, it implies it matches the exclusion selector.
       
       Let's try a different approach:
       We apply the style to ALL buttons.
       Then we override for the last-child ONLY IF it is the plus tab.
       But we can't condition on "if it is the plus tab".
       
       Wait, if the 5th tab is open, active_count=5. plus_visible=False.
       Gradio sets style="display: none" on the + tab button wrapper?
       Native tabs: the button is inside .tab-nav.
       When visible=False, Gradio sets display:none on the button.
       So it is still in the DOM. :last-child still targets it.
       So the 5th tab is :nth-child(5). It is NOT :last-child.
       So :not(:last-child) should match it.
       
       Maybe the user means the 5th tab is the last one *visible*?
       
       Let's just apply to ALL buttons and verify.
       And for the one with specific styling (the plus tab), we hide the pseudo element.
    */
}

#civlens-search-tabs > .tab-nav > button:hover::after,
#civlens-search-tabs > .tab-nav > button.selected::after {
    opacity: 1;
}

/* Hide X for the + tab. 
   We styled the + tab with specific rules in previous CSS block?
   We targeted #civlens-search-tabs > .tab-nav > button:last-child
   
   If the + tab is hidden, it is still :last-child.
   So the rule applies to it.
   
   The 5th tab is :nth-child(5).
   
   If the user says 5th tab has no X, maybe my previous selector :not(:last-child) was correct but something else interfered?
   
   Let's just be explicit.
*/

/* Specific styling for the "+" tab */
#civlens-search-tabs > .tab-nav > button:last-child {
    padding: 6px 12px !important;
    font-size: 16px !important;
    color: #94a3b8 !important;
    background: transparent !important;
    border: none !important;
}

#civlens-search-tabs > .tab-nav > button:last-child:hover {
    color: #3b82f6 !important;
    background: rgba(59, 130, 246, 0.1) !important;
}

/* Reduce vertical spacing */
#civlens-ext .gr-group + .gr-row,
#civlens-ext .gr-group ~ .gr-row {
    margin-top: 2px !important;
    padding-top: 0 !important;
}

#civlens-ext hr {
    margin: 2px 0 !important;
}

/* Buttons */
#civlens-ext .btn-load .gr-button,
#civlens-ext .btn-load button {
    background: linear-gradient(180deg, rgba(96,165,250,0.35), rgba(29,78,216,0.35));
    border: 1px solid rgba(96,165,250,0.55);
    color: #e2e8f0;
    padding: 6px 14px;
    height: 36px;
    border-radius: 10px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-left: 8px;
}

#civlens-ext .btn-load .gr-button:hover,
#civlens-ext .btn-load button:hover {
    background: rgba(30,58,138,0.55);
    border-color: rgba(29,78,216,0.75);
    color: #fff;
}

#civlens-ext .btn-load {
    flex: 1 1 auto;
}

#civlens-ext .btn-load .gr-button,
#civlens-ext .btn-load button {
    width: 100%;
    justify-content: center;
    font-weight: 600;
}

#civlens-ext .btn-refine-orange .gr-button,
#civlens-ext .btn-refine-orange button {
    background: #f97316;
    border: 1px solid #fb923c;
    color: #0b0f19;
    padding: 6px 14px;
    height: 36px;
    border-radius: 10px;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

#civlens-ext .btn-refine-orange .gr-button:hover,
#civlens-ext .btn-refine-orange button:hover {
    background: #fb923c;
    border-color: #fdba74;
}

#civlens-ext .btn-download .gr-button,
#civlens-ext .btn-download button {
    width: 100%;
    justify-content: center;
    font-weight: 600;
    height: 42px;
    border-radius: 12px;
}

#civlens-ext .download-progress .progress-bar {
    height: 16px;
    background: #0f172a;
    border: 1px solid #1f2937;
    border-radius: 10px;
    overflow: hidden;
}

#civlens-ext .download-progress .progress-fill {
    height: 100%;
    background: #3b82f6;
    transition: width 0.2s ease;
}

#civlens-ext .content-center {
    margin-left: auto !important;
    margin-right: auto !important;
    display: flex;
    align-items: center;
    justify-content: center;
    max-width: 420px;
}
